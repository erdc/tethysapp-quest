{% load staticfiles tethys_gizmos %}

<div id="tabs">

  <!-- Nav tabs -->
  <ul class="nav nav-pills" role="tablist">
    <li role="presentation" class="nav-tab active"><a id="manage-tab" href="#manage" aria-controls="manage" role="tab" data-toggle="tab">Manage</a></li>
    <li role="presentation" class="nav-tab"><a href="#search" aria-controls="search" role="tab" data-toggle="tab">Search</a></li>
  </ul>

  <!-- Manage Tab Pane -->
  <div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="manage">
      <h1 class="title">Collections
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#new-collection-modal">+</button>
      </h1>
      <div id="collections-list">
        {% for collection in collections %}
          <div>{% include 'data_browser/collection.html' with collection=collection %}</div>
        {% endfor %}
      </div>
    </div>

    <!-- Search Tab Pane -->
    <div role="tabpanel" class="tab-pane" id="search">
      <h1 class="title">Filters</h1>

      <form id="search-form" action="{% url 'data_browser:get_features' %}" method="get">
        {% csrf_token %}

      <div class="filter-group collapsible-container">
        <div class="collapsible" data-toggle="collapse" data-target="#collapse-parameters" aria-expanded="false" aria-controls="#collapse-parameters">
          <span class="caret"></span>
        </div>
        <h2>Parameters</h2>
        <div class="collapse in" id="collapse-parameters">
          {% for parameter in parameters %}
            <div id="parameter-radio" class="radio">
              <label>
                <input type="radio" name="parameter" id="parameter-option-{{ forloop.counter }}" value="{{ parameter }}">
                {{ parameter }}
              </label>
            </div>
          {% endfor %}
        </div>
      </div>

      <div class="filter-group collapsible-container">
        <div class="collapsible collapsed" data-toggle="collapse" data-target="#collapse-services" aria-expanded="false" aria-controls="#collapse-services">
          <span class="caret"></span>
        </div>
        <h2>Services</h2>
        <div class="collapse" id="collapse-services">
          <div class="checkbox-tree">
            {% if checkbox_tree.title %}{{ checkbox_tree.title }}{% endif %}
            {% if checkbox_tree.sub_trees %}
              <ul class="list-unstyled">
                {% include 'data_browser/checkbox_sub_tree.html' with checkbox_tree=checkbox_tree id="0" %}
              </ul>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="filter-group">
        <div class="collapsible collapsed" data-toggle="collapse" data-target="#collapse-geometry" aria-expanded="false" aria-controls="#collapse-geometry">
          <span class="caret"></span>
        </div>
        <h2>Geometry Type</h2>
        <div class="collapse" id="collapse-geometry">
          {% for geom_type in geom_types %}
            <div class="radio">
              <label>
                <input type="radio" name="geom_type-options" id="geom_type-option-{{ forloop.counter }}" value="{{ geom_type.1 }}">
                {{ geom_type.0 }}
              </label>
            </div>
          {% endfor %}
        </div>
      </div>
      </form>
      <div>
        <div>
          <button id="search-button" class="btn btn-primary" type="submit" form="search-form">
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            Search
          </button>
          <img src="{% static 'data_browser/images/loading.gif' %}" id="loading-gif-search" style="display: none;">
        </div>
        <div>
          <button id="add-to-collection-button" type="button" class="btn btn-success" data-toggle="modal" data-target="#add-features-modal" style="display: none;">
            <span class="glyphicon glyphicon-add" aria-hidden="true"></span>
            Add to Collection
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- New Collection Modal -->
<div class="modal fade" id="new-collection-modal" tabindex="-1" role="dialog" aria-labelledby="new-collection-modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="new-collection-title">New Collection</h4>
      </div>
      <div class="modal-body">
        <form id="new-collection-form" action="{% url 'data_browser:new_collection_workflow' %}" method="post">
          {% csrf_token %}
          <div class="form-group">
            <label for="collection_name">Collection Name</label>
            <input type="text" class="form-control" id="collection_name" name="collection_name" placeholder="New Collection">
          </div>
          <div class="form-group">
            <label for="description">Description</label>
            <input type="text" class="form-control" id="description" name="description" placeholder="New Collection">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id='new-collection-submit' type="submit" class="btn btn-primary" form="new-collection-form" value="Submit">Submit</button>
      </div>
    </div>
  </div>
</div>

<!-- Add To Collection Modal -->
<div class="modal fade" id="add-features-modal" tabindex="-1" role="dialog" aria-labelledby="add-features-modal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="add-features-title">Add Features to Collection</h4>
      </div>
      <div class="modal-body">
        <form id="add-features-form" action="{% url 'data_browser:add_features_workflow' %}" method="post">
          <div id="number-of-selected-features"></div>
          {% csrf_token %}
          {% if collection_select_options.options %}
            {% gizmo select_input collection_select_options %}
            <h4>Add Feaures to New Collection</h4>
            <hr>
          {% endif %}
          {% gizmo new_collection_name_text_options %}
          {% gizmo new_collection_description_text_options %}
        </form>
      </div>
      <div class="modal-footer">
        <button id='add-features-submit' type="submit" class="btn btn-primary" form="add-features-form" value="Submit">Submit</button>
      </div>
    </div>
  </div>
</div>
