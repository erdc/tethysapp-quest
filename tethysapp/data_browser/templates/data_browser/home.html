{% extends "data_browser/base.html" %}
{% load staticfiles tethys_gizmos %}

{% block import_gizmos %}
  {% import_gizmo_dependency date_picker %}
  {% import_gizmo_dependency datatable_view %}
  {% import_gizmo_dependency plotly_view %}
  {% import_gizmo_dependency select_input %}
{% endblock %}

{% block global_scripts %}
  {{ block.super }}
   <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/colreorder/1.3.2/js/dataTables.colReorder.min.js"></script>
{% endblock %}

{% block styles %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/colreorder/1.3.2/css/colReorder.dataTables.min.css">
{% endblock %}

{% block app_content %}
  <div id="layout"></div>

  {% gizmo map_view map_view_options %}


  <div id="hidden">

    <!-- Collection Details Tables -->
    <div id="collection-details-container" class="app-content">
      <button type="button" class="close" id="close-table-btn" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div id="collection-details-nav">
        <ul class="nav nav-pills nav-justified" role="tablist">
        </ul>
      </div>

      <div id="collection-details-content" class="tab-content">
        <div id="table-placeholder" class="text-center">
          <h1>No Collections have been created</h1>
          <button type="button" class="btn btn-lg btn-primary" data-toggle="modal" data-target="#new-collection-modal">Create Collection</button>
        </div>
      </div>
    </div>

    <!-- Metadata Container -->
    <div id="metadata-container">
      <button type="button" class="close" id="close-metadata-btn" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div id="metadata-content"></div>
    </div>

    <!-- Plot Container -->
    <div id="plot-container">
      <div id="plot-content"></div>
      <div id="plot-content-placeholder" class="text-center">
        <h1>No datasets have been visualized</h1>
        <div>To visualize a dataset right click on a location on the map and select visualize, or click the View button for a dataset in the table.</div>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <ul id="details-context-menu" class="dropdown-menu" role="menu" style="display:none" ></ul>

{% endblock %}

{% block app_actions %}
  <div id="layout-nav">
    <ul class="nav nav-pills nav-justified" role="tablist">
      <li role="presentation" class="nav-tab"><a href="" id="table-toggle" aria-controls="table" role="tab" data-toggle="tab">Table</a></li>
    </ul>
  </div>
  <div id="pending-tasks" style="display: none;">
    <img src="{% static 'data_browser/images/loading.gif' %}" >
  </div>
{% endblock %}

{% block after_app_content %}
    <!-- Download/Filter/Visualize Options Modal -->
    <div class="modal fade" id="options-modal" tabindex="-1" role="dialog" aria-labelledby="options-modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content" id="options-content">
        </div>
      </div>
    </div>

    <!-- New Collection Modal -->
    <div class="modal fade" id="new-collection-modal" tabindex="-1" role="dialog" aria-labelledby="new-collection-modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="new-collection-title">New Collection</h4>
          </div>
          <div class="modal-body">
            <form id="new-collection-form" action="{% url 'data_browser:new_collection_workflow' %}" method="post">
              {% csrf_token %}
              <div class="form-group">
                <label for="collection_name">Collection Name</label>
                <input type="text" class="form-control" id="collection_name" name="collection_name" placeholder="New Collection">
              </div>
              <div class="form-group">
                <label for="description">Description</label>
                <input type="text" class="form-control" id="description" name="description" placeholder="New Collection">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button id='new-collection-submit' type="submit" class="btn btn-primary" form="new-collection-form" value="Submit">Submit</button>
            <img src="{% static 'data_browser/images/loading.gif' %}" id="new-collection-loading-gif" style="display: none;">
          </div>
        </div>
      </div>
    </div>

    <!-- Add To Collection Modal -->
    <div class="modal fade" id="add-features-modal" tabindex="-1" role="dialog" aria-labelledby="add-features-modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="add-features-title">Add Features to Collection</h4>
          </div>
          <div class="modal-body">
            <form id="add-features-form" action="{% url 'data_browser:add_features_workflow' %}" method="post">
              <div id="number-of-selected-features"></div>
              {% csrf_token %}
              <div id="add-features-collection-select-div"{% if not collection_select_options.options %}style="display: none;"{% endif %}>
                {% gizmo select_input collection_select_options %}
                <h4>Add Feaures to New Collection</h4>
                <hr>
              </div>
              {% gizmo new_collection_name_text_options %}
              {% gizmo new_collection_description_text_options %}
            </form>
          </div>
          <div class="modal-footer">
            <button id='add-features-submit' type="submit" class="btn btn-primary" form="add-features-form" value="Submit">Submit</button>
            <img src="{% static 'data_browser/images/loading.gif' %}" id="add-features-loading-gif" style="display: none;">
          </div>
        </div>
      </div>
    </div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="/static/tethys_gizmos/js/gizmo_utilities.js" type="text/javascript"></script>
  <script>
    var add_data_url = '{% url 'data_browser:add_data_workflow' %}';
    var delete_feature_url = '{% url 'data_browser:delete_feature_workflow' %}';
    var show_metadata_url = '{% url 'data_browser:show_metadata_workflow' %}';
    var get_download_options_url = '{% url 'data_browser:get_download_options_workflow' %}';
    var export_dataset_url = '{% url 'data_browser:export_dataset' %}';
    var get_filter_list_url = '{% url 'data_browser:get_filter_list_workflow' %}';
    var get_filter_options_url = '{% url 'data_browser:get_filter_options_workflow' %}';
    var visualize_dataset_url = '{% url 'data_browser:visualize_dataset_workflow' %}';
    var get_features_url = '{% url 'data_browser:get_features' %}';
    var delete_dataset_url = '{% url 'data_browser:delete_dataset_workflow' %}';
    var get_collections_url = '{% url 'data_browser:get_collections' %}';
    var get_collection_data_url = '{% url 'data_browser:get_collection_data' %}';
    var services = {% autoescape off %}{{ services }}{% endautoescape %};
    var source_urls = [];
    <!--[{% for service in services %}'{% url 'data_browser:get_features' %}?service={{ service }}', {% endfor %}];-->
  </script>
  <script src="{% static 'data_browser/js/main.js' %}" type="text/javascript"></script>
  <script src="{% static 'data_browser/js/layout.js' %}" type="text/javascript"></script>
  <script src="{% static 'data_browser/js/map.js' %}" type="text/javascript"></script>
  <script src="{% static 'data_browser/vendor/ol3-contextmenu/ol3-contextmenu.js' %}" type="text/javascript"></script>
{% endblock %}
